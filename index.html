<!DOCTYPE html>
<html>
<head>
    <title>eBay Auth Callback</title>
</head>
<body>
    <div id="debug"></div>
    <script>
        function log(message) {
            console.log(message);
            document.getElementById('debug').innerHTML += `${new Date().toISOString()}: ${message}<br>`;
        }

        log('Page loaded');
        log('User Agent: ' + navigator.userAgent);
        const urlParams = new URLSearchParams(window.location.search);
        log('Full URL: ' + window.location.href);
        const code = urlParams.get('code');
        log('Code received: ' + (code ? 'yes' : 'no'));
        
        if (code) {
            // Keep the double slashes and ensure proper encoding
            const redirectUrl = `freyaapp://?code=${encodeURIComponent(code)}`;
            log('Attempting redirect to: ' + redirectUrl);
            
            // Try multiple approaches to redirect
            window.location.href = redirectUrl;
            window.location.replace(redirectUrl);
            
            // If still here after 1 second, show manual instructions
            setTimeout(() => {
                document.body.innerHTML = `
                    <h3>Redirect failed</h3>
                    <p>Please copy this code and return to the app:</p>
                    <textarea onclick="this.select()">${code}</textarea>
                    <p>Or click this link:</p>
                    <a href="${redirectUrl}">Return to App</a>
                `;
            }, 1000);
        } else {
            log('No authorization code received');
            document.body.innerHTML = `
                <h3>Error</h3>
                <p>No authorization code received from eBay.</p>
                <p>URL Parameters:</p>
                <pre>${JSON.stringify(Object.fromEntries(urlParams), null, 2)}</pre>
            `;
        }
    </script>
</body>
</html>
