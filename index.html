<!DOCTYPE html>
<html>
<head>
    <title>eBay Auth Callback</title>
</head>
<body>
    <div id="debug"></div>
    <script>
        function log(message) {
            console.log(message);
            document.getElementById('debug').innerHTML += `${new Date().toISOString()}: ${message}<br>`;
        }

        log('Page loaded');
        log('User Agent: ' + navigator.userAgent);
        const urlParams = new URLSearchParams(window.location.search);
        log('Full URL: ' + window.location.href);
        const code = urlParams.get('code');
        log('Code received: ' + (code ? 'yes' : 'no'));
        
        if (code) {
            const redirectUrl = `freyaapp://?code=${encodeURIComponent(code)}`;
            log('Attempting redirect to: ' + redirectUrl);
            
            // Try redirect with a promise
            Promise.race([
                new Promise(resolve => {
                    window.location.href = redirectUrl;
                    log('Tried window.location.href');
                    setTimeout(resolve, 100);
                }),
                new Promise(resolve => {
                    window.location.replace(redirectUrl);
                    log('Tried window.location.replace');
                    setTimeout(resolve, 100);
                })
            ]).then(() => {
                log('Redirect attempts completed');
            });
        } else {
            log('No authorization code received');
            document.body.innerHTML = `
                <h3>Error</h3>
                <p>No authorization code received from eBay.</p>
                <p>URL Parameters:</p>
                <pre>${JSON.stringify(Object.fromEntries(urlParams), null, 2)}</pre>
            `;
        }
    </script>
</body>
</html>
